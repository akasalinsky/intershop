<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Витрина товаров</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .product-card {
            border: 1px solid #ddd;
            padding: 15px;
            width: 300px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }
        .controls { margin-top: 10px; }
        .btn { margin: 0 5px; padding: 5px 10px; cursor: pointer; }
        .pagination { margin: 20px 0; text-align: center; }
        .pagination a, .pagination span { margin: 0 5px; }
        .toolbar { margin-bottom: 20px; display: flex; gap: 15px; align-items: center; }
    </style>
</head>
<body>
<!-- Кнопки навигации -->
<div style="text-align: right; margin-bottom: 20px;">
    <a href="/orders"><b>ЗАКАЗЫ &rarr;</b></a> |
    <a href="/cart"><b>КОРЗИНА &rarr;</b></a>
</div>

<h1 style="text-align: center;">Витрина товаров</h1>

<!-- Панель фильтров и пагинации -->
<div class="toolbar">
    <div>
        <label>Найти: </label>
        <input type="text" placeholder="Поиск..." disabled />
    </div>

    <div>
        <label>Сортировка: </label>
        <select onchange="alert('Сортировка временно недоступна')">
            <option>по алфавиту</option>
            <option>по цене</option>
        </select>
    </div>

    <!-- Выбор количества на странице -->
    <div>
        <label>Товаров на странице: </label>
        <select th:onChange="location.href='?page=1&size=' + this.value">
            <option th:value="5"  th:selected="${paging.pageSize == 5}">5</option>
            <option th:value="10" th:selected="${paging.pageSize == 10}">10</option>
            <option th:value="20" th:selected="${paging.pageSize == 20}">20</option>
            <option th:value="50" th:selected="${paging.pageSize == 50}">50</option>
        </select>
    </div>
</div>

<!-- Список товаров -->
<div class="product-grid">
    <div class="product-card" th:each="product : ${products}">
        <img th:src="${product.imageUrl}" alt="Фото товара" />
        <h3 th:text="${product.name}">Название</h3>
        <p th:text="${product.description}">Описание</p>
        <p><b th:text="${product.price} + ' руб.'">0.00 руб.</b></p>

        <!-- Внутри th:each="product : ${products}" -->
        <div class="controls">
            <!-- Кнопка "-" -->
            <form th:action="@{/cart/update/{id}(id=${product.id})}" method="post" style="display: inline;">
        <span th:with="currentQty=${cartItemQuantity.get(product.id) ?: 0}">
            <button type="submit" name="quantity" th:value="${currentQty - 1}" th:disabled="${currentQty le 0}">-</button>
        </span>
            </form>

            <!-- Отображение количества -->
            <span th:text="${cartItemQuantity.get(product.id) ?: 0}">0</span>

            <!-- Кнопка "+" -->
            <form th:action="@{/cart/update/{id}(id=${product.id})}" method="post" style="display: inline;">
        <span th:with="currentQty=${cartItemQuantity.get(product.id) ?: 0}">
            <button type="submit" name="quantity" th:value="${currentQty + 1}">+</button>
        </span>
            </form>

            <!-- Кнопка "В корзину" -->
            <form th:action="@{/cart/add/{id}(id=${product.id})}" method="post" style="display: inline;">
                <button type="submit" class="btn" th:if="${cartItemQuantity.get(product.id) == null or cartItemQuantity.get(product.id) == 0}">В корзину</button>
            </form>

            <!-- Кнопка "Удалить" (крестик) -->
            <form th:action="@{/cart/remove/{id}(id=${product.id})}" method="post" style="display: inline;" th:if="${cartItemQuantity.get(product.id) != null and cartItemQuantity.get(product.id) > 0}">
                <button type="submit" class="btn">&times;</button>
            </form>
        </div>
    </div>
</div>

<!-- Пагинация -->
<div class="pagination">
        <span th:if="${paging.currentPage > 1}">
            <a th:href="@{/(page=1, size=${paging.pageSize})}"><< Первая</a>
            <a th:href="@{/(page=${paging.currentPage - 1}, size=${paging.pageSize})}">< Предыдущая</a>
        </span>

    <span>Страница <b th:text="${paging.currentPage}"></b> из <b th:text="${paging.totalPages}"></b></span>

    <span th:if="${paging.currentPage < paging.totalPages}">
            <a th:href="@{/(page=${paging.currentPage + 1}, size=${paging.pageSize})}">Следующая ></a>
            <a th:href="@{/(page=${paging.totalPages}, size=${paging.pageSize})}">Последняя >></a>
        </span>
</div>
</body>
</html>